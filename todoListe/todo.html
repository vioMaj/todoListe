<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>toDoListe</title>
</head>
<body>
    <script>
        function searchResultat() {
            const searchTerm = document.getElementById('searchbar').value.toLowerCase();
            const entries = document.querySelectorAll('.entry');

            entries.forEach(entry => {
                const title = entry.querySelector('.boxtitel').textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    entry.style.display = 'block';
                } else {
                    entry.style.display = 'none';
                }
            });
        }

        function openHinzufuegen() {
            document.getElementById('hinzufuegenPop').style.display = 'block';
        }

        function closeHinzufuegen() {
            document.getElementById('hinzufuegenPop').style.display = 'none';
            document.getElementById('formHinzufuegen').reset();
        }

        function deleteEintrag(button) {
            let deleteBox = window.confirm("Sind Sie sicher, dass Sie den ausgewählten Eintrag löschen wollen?");
            if (deleteBox == true) {
                let entry = button.closest('.entry');
                entry.remove();
                updateErledigtProzent();
            }
        }

        function updateEintrag(button) {
            // Funktion zur Aktualisierung eines Eintrags
        }

        function berechnePrioritaet(wichtig, dringend) {
            if (wichtig && dringend) {
                return 'schnell erledigen';
            } else if (wichtig) {
                return 'muss noch erledigt werden';
            } else if (dringend) {
                return 'heute noch';
            } else {
                return 'weg damit';
            }
        }

        function addDaten(titel, beschreibung, autor, kategorie, wichtig, dringend, startdatum, enddatum) {
            let container = document.getElementById('eintraege');
            let entry = document.createElement('div');
            entry.className = 'entry';

            let prioritaet = berechnePrioritaet(wichtig, dringend);

            entry.innerHTML = `
                <div class="header">
                    <input type="checkbox" name="abgehackt" class="abgehackt" onclick="updateErledigtProzent()"><b class="boxtitel">${titel}</b>
                    <p>Beschreibung: ${beschreibung}</p>
                    <p>Enddatum: ${enddatum}</p>
                    <div class="details">
                        <p>Autor: ${autor}</p>
                        <p>Kategorie: ${kategorie}</p>
                        <p>Wichtig: ${wichtig ? 'Ja' : 'Nein'}</p>
                        <p>Dringend: ${dringend ? 'Ja' : 'Nein'}</p>
                        <p>Priorität: ${prioritaet}</p>
                        <p>Startdatum: ${startdatum}</p>
                    </div>
                    <button onclick="toggleDetails(this)" id="erweitern"><b>&#11015;</b></button>
                    <button onclick="updateEintrag(this)" class="btns">&#x270E</button>
                    <button onclick="deleteEintrag(this)" class="btns">&#128465</button>
                </div>
            `;

            container.appendChild(entry);
            updateErledigtProzent();
        }

        function toggleDetails(button) {
            let entry = button.closest('.entry');
            entry.classList.toggle('expanded');
            button.querySelector('b').classList.toggle('rotate');
        }

        function updatePriority() {
            const wichtig = document.getElementById('wichtig').checked;
            const dringend = document.getElementById('dringend').checked;
            const priorityElement = document.getElementById('prioritaet');

            let prioritaet = berechnePrioritaet(wichtig, dringend);
            priorityElement.textContent = `Priorität: ${prioritaet}`;
        }

        function updateErledigtProzent() {
            const checkboxes = document.querySelectorAll('.abgehackt');
            const total = checkboxes.length;
            const checked = Array.from(checkboxes).filter(checkbox => checkbox.checked).length;
            const percent = total === 0 ? 0 : Math.round((checked / total) * 100);
            document.getElementById('anzeigenErledigt').textContent = `TODO's abgehakt: ${percent}%`;
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('formHinzufuegen').addEventListener('submit', function(e) {
                e.preventDefault();

                let titel = document.getElementById('titel').value;
                let beschreibung = document.getElementById('beschreibung').value;
                let autor = document.getElementById('autor').value;
                let kategorie = document.querySelector('select[name="kategorie"]').value;
                let wichtig = document.getElementById('wichtig').checked;
                let dringend = document.getElementById('dringend').checked;
                let startdatum = document.getElementById('startdatum').value;
                let enddatum = document.getElementById('enddatum').value;

                addDaten(titel, beschreibung, autor, kategorie, wichtig, dringend, startdatum, enddatum);

                document.getElementById('formHinzufuegen').reset();
                closeHinzufuegen();
            });
            // alle Eventlistener, die gebraucht werden (schaut, ob etwas bei den jeweiligen Elementen geändert werden)
            document.getElementById('wichtig').addEventListener('change', updatePriority);
            document.getElementById('dringend').addEventListener('change', updatePriority);
            document.getElementById('searchbar').addEventListener('input', searchResultat);
        });
    </script>
    <div id="oben">
    <h1 id="logo">&#9775 TODO Liste</h1>
    <h2 id="spruch">Deine originelle Liste. Dein organisiertes Leben.</h2>

    <input id="searchbar" class="search" type="search" placeholder="&#8981   Eintrag suchen..." onkeypress="if(event.keyCode === 13) searchResultat();">
    <button id="hinzufuegen" onclick="openHinzufuegen()">Eintrag hinzufügen +</button><br>
    <p id="anzeigenErledigt">TODO's abgehakt: 0%</p>
    </div>
    <div class="popup" id="hinzufuegenPop" style="display:none;">
        <form id="formHinzufuegen">
            <label for="titel">Titel:</label>
            <input type="text" name="titel" id="titel" required> <br><br>
            <label for="beschreibung">Beschreibung:</label>
            <textarea name="beschreibung" id="beschreibung" required></textarea><br><br>
            <label for="autor">Autor:</label>
            <input type="text" name="autor" id="autor" required><br><br>
            <label for="kategorie">Kategorie:</label>
            <select name="kategorie" required>
                <option value="default">Kategorie</option>
                <option value="Sport">Sport</option>
                <option value="Schule">Schule</option>
                <option value="Freizeit">Freizeit</option>
                <option value="Arbeit">Arbeit</option>
                <option value="Familie/Freunde">Familie/Freunde</option>
            </select>
            <br><br>
            Wichtig<input type="checkbox" name="wichtig" id="wichtig">
            Dringend<input type="checkbox" name="dringend" id="dringend">
            <br>
            <p id="prioritaet">Priorität: Weg damit</p>
            <label for="startdatum">Startdatum:</label>
            <input type="date" name="startdatum" id="startdatum" required><br><br>
            <label for="enddatum">Enddatum:</label>
            <input type="date" name="enddatum" id="enddatum" required><br>
            <button type="button" onclick="closeHinzufuegen()" class="btnsPopup">Abbrechen</button>
            <input type="submit" class="btnsPopup" value="Eintrag hinzufügen">
        </form>
    </div>

    <div id="eintraege" class="eintraege"></div>
</body>
